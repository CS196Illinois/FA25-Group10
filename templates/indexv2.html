<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Class Notes - UIUC Turbolearn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ===== MAJOR CHANGE #1: External CSS System ===== -->
  <!-- BEFORE: All styles were inline in a <style> tag with hardcoded colors -->
  <!-- NOW: Uses turbolearn-darkmode.css with CSS custom properties for light/dark mode support -->
  <link rel="stylesheet" href="{{ url_for('static', filename='turbolearn-darkmode.css') }}">
  
  <!-- ===== MAJOR CHANGE #2: Typography System ===== -->
  <!-- BEFORE: Used generic system fonts -->
  <!-- NOW: Uses Google Fonts (Merriweather for headings, Inter for body text) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ===== MAJOR CHANGE #3: CSS Custom Properties (Variables) ===== */
    /* BEFORE: Colors were hardcoded like #1a1f2e, #667eea, rgba(26, 31, 51, 0.6) */
    /* NOW: Uses CSS variables that automatically change with light/dark mode:
       - var(--bg-paper): Main background
       - var(--bg-card): Card backgrounds
       - var(--text-primary): Main text color
       - var(--accent-terracotta): Primary accent color
       - var(--border-light): Subtle borders
       - var(--shadow-md): Consistent shadows
       These variables are defined in turbolearn-darkmode.css and change values
       when data-theme attribute switches between "light" and "dark"
    */
    
    /* Additional styles specific to the notes page that extend turbolearn-darkmode.css */
    
    /* Main page container */
    .notes-page {
      min-height: 100vh;
      padding: 40px 0;
      background: var(--bg-paper);
    }
    
    /* Page title */
    /* CHANGE: Now uses var(--font-serif) and var(--text-primary) instead of hardcoded values */
    /* CHANGE: Uses clamp() for responsive font sizing */
    .notes-title {
      font-family: var(--font-serif);
      font-size: clamp(2rem, 4vw, 2.8rem);
      font-weight: 900;
      margin-bottom: 32px;
      color: var(--text-primary);
      letter-spacing: -0.02em;
    }
    
    /* Filter section card */
    /* CHANGE: Background uses var(--bg-card) instead of rgba(26, 31, 51, 0.6) */
    /* CHANGE: Border uses var(--border-light) instead of rgba(102, 126, 234, 0.2) */
    /* CHANGE: Shadow uses var(--shadow-md) instead of hardcoded box-shadow */
    /* CHANGE: Border radius uses var(--radius-lg) for consistency */
    .filter-section {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 32px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
    }
    
    /* Filter form layout */
    .filter-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .filter-row:last-child {
      margin-bottom: 0;
    }
    
    /* Form controls */
    /* CHANGE: All form elements now use CSS variables for colors */
    /* BEFORE: border: 1px solid rgba(102, 126, 234, 0.3) */
    /* NOW: border: 1px solid var(--border-light) */
    /* BEFORE: background: rgba(23, 27, 46, 0.8) */
    /* NOW: background: var(--bg-paper-dark) */
    select, input, textarea {
      padding: 12px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-paper-dark);
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: var(--font-sans);
    }
    
    select:hover, input:hover, textarea:hover {
      border-color: var(--border-medium);
    }
    
    /* CHANGE: Focus state now uses accent color with consistent shadow */
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-terracotta);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }
    
    select {
      min-width: 150px;
      cursor: pointer;
    }
    
    /* Search input */
    .search-input {
      flex: 1;
      min-width: 200px;
    }
    
    /* Buttons */
    /* CHANGE: Button styling now uses accent colors from theme */
    /* BEFORE: background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) */
    /* NOW: background: var(--accent-terracotta) - simpler, theme-aware */
    .btn-search {
      background: var(--accent-terracotta);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
      white-space: nowrap;
    }
    
    .btn-search:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-search:active {
      transform: translateY(0);
    }
    
    /* Note count badge */
    /* CHANGE: Uses theme colors instead of hardcoded purple */
    .note-count {
      background: var(--bg-paper-dark);
      padding: 8px 16px;
      border-radius: var(--radius-lg);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
      border: 1px solid var(--border-light);
      margin-left: auto;
    }
    
    /* Note cards */
    /* CHANGE: Card backgrounds and borders now theme-aware */
    /* CHANGE: Hover effects use consistent shadow variables */
    .card {
      background: var(--bg-card);
      padding: 24px;
      border-radius: var(--radius-lg);
      margin-bottom: 20px;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    
    .card:hover {
      transform: translateY(-2px);
      border-color: var(--border-medium);
      box-shadow: var(--shadow-md);
    }
    
    /* Note title */
    /* CHANGE: Uses serif font from theme system */
    .note-title {
      font-family: var(--font-serif);
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 10px;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }
    
    /* Note metadata */
    .note-meta {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    /* CHANGE: Meta tags now use accent color for consistency */
    .meta-tag {
      background: var(--bg-paper-dark);
      padding: 4px 12px;
      border-radius: var(--radius-lg);
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-terracotta);
      border: 1px solid var(--border-light);
    }
    
    /* Note body */
    .note-body {
      white-space: pre-wrap;
      line-height: 1.7;
      color: var(--text-secondary);
      font-size: 15px;
    }
    
    /* Create note section */
    .create-section {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 28px;
      margin-top: 40px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
    }
    
    .section-title {
      font-family: var(--font-serif);
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    
    /* Form layout */
    form textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      line-height: 1.6;
    }
    
    form input, form select {
      width: 100%;
    }
    
    form .two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media(max-width: 900px) {
      form .two {
        grid-template-columns: 1fr;
      }
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      color: var(--text-tertiary);
      margin: 60px 0;
      font-size: 16px;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* Note actions */
    .note-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }
    
    /* Action buttons */
    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    /* CHANGE: Edit button now uses accent-terracotta instead of purple gradient */
    .btn-edit {
      background: var(--accent-terracotta);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-edit:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    /* CHANGE: Delete button uses consistent red (not gradient) */
    /* Kept as hardcoded red since it's a universal danger color */
    .btn-delete {
      background: #dc2626;
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-delete:hover {
      background: #b91c1c;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    /* CHANGE: Cancel button uses theme neutrals */
    .btn-cancel {
      background: var(--bg-paper-dark);
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
    }
    
    .btn-cancel:hover {
      background: var(--bg-paper);
      color: var(--text-primary);
    }
    
    /* Edit form */
    .edit-form {
      display: none;
      margin-top: 16px;
      padding: 16px;
      background: var(--bg-paper-dark);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
    }
    
    .edit-form.active {
      display: block;
    }
    
    .note-content.editing {
      display: none;
    }
    
    /* Load more button container */
    .load-more-container {
      text-align: center;
      margin: 20px 0;
    }
    
    /* Responsive */
    @media(max-width: 768px) {
      .notes-title {
        font-size: 32px;
      }
      
      .filter-section {
        padding: 16px;
      }
      
      .card {
        padding: 20px;
      }
      
      .note-actions {
        flex-wrap: wrap;
      }
      
      .filter-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      select {
        min-width: auto;
        width: 100%;
      }
      
      .note-count {
        margin-left: 0;
      }
    }
  </style>

  <script>
    // Toggle edit form visibility
    function toggleEdit(noteId) {
      const editForm = document.getElementById('edit-form-' + noteId);
      const noteContent = document.getElementById('note-content-' + noteId);
      editForm.classList.toggle('active');
      noteContent.classList.toggle('editing');
    }
  </script>
</head>
<body>
  <!-- ===== MAJOR CHANGE #4: Added Header with Theme Toggle ===== -->
  <!-- BEFORE: Page started directly with content, no header -->
  <!-- NOW: Added consistent header from homepage with:
       - Logo that links back to home
       - Theme toggle button (moon/sun icon)
       This provides navigation and light/dark mode switching
  -->
  <header class="tl-header">
    <div class="tl-container">
      <nav class="tl-nav">
        <a href="{{ url_for('home') }}" class="tl-logo">
          <div class="tl-logo-mark">TL</div>
          <div class="tl-logo-text">
            <span class="tl-logo-main">UIUC Turbolearn</span>
            <span class="tl-logo-sub">Class Notes</span>
          </div>
        </a>
        
        <div class="tl-nav-actions">
          <!-- Theme toggle button - switches between light and dark mode -->
          <button class="theme-toggle" aria-label="Toggle dark mode">
            <span class="moon-icon">üåô</span>
            <span class="sun-icon">‚òÄÔ∏è</span>
          </button>
        </div>
      </nav>
    </div>
  </header>

  <!-- ===== Main Content (Functionality Unchanged) ===== -->
  <!-- All functionality below is the same as index.html, just with updated styling -->
  <div class="notes-page">
    <div class="tl-container">
      <div class="notes-title">üìö Class Notes</div>
   
      <!-- Filter and Search Bar -->
      <div class="filter-section">
        <form method="get" action="/notes-feed" class="filter-form">

          <!-- Row 1: Main filters -->
          <div class="filter-row">
            <!-- Filter by class -->
            <select name="class_filter" onchange="this.form.submit()">
              <option value="All" {% if selected_filter == "All" %}selected{% endif %}>All Classes</option>
              {% for c in classes %}
              <option value="{{ c }}" {% if selected_filter == c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>

            <!-- Filter by author -->
            <select name="author_filter" onchange="this.form.submit()">
              <option value="All" {% if author_filter == "All" %}selected{% endif %}>All Authors</option>
              {% for a in authors %}
              <option value="{{ a }}" {% if author_filter == a %}selected{% endif %}>{{ a }}</option>
              {% endfor %}
            </select>

            <!-- Filter by date -->
            <select name="date_filter" onchange="this.form.submit()">
              <option value="All" {% if date_filter == "All" %}selected{% endif %}>All Time</option>
              <option value="Today" {% if date_filter == "Today" %}selected{% endif %}>Today</option>
              <option value="Week" {% if date_filter == "Week" %}selected{% endif %}>This Week</option>
              <option value="Month" {% if date_filter == "Month" %}selected{% endif %}>This Month</option>
            </select>

            <!-- Sort options -->
            <select name="sort_by" onchange="this.form.submit()">
              <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>Most Recent</option>
              <option value="oldest" {% if sort_by == "oldest" %}selected{% endif %}>Oldest First</option>
              <option value="title" {% if sort_by == "title" %}selected{% endif %}>Title (A-Z)</option>
              <option value="author" {% if sort_by == "author" %}selected{% endif %}>Author (A-Z)</option>
            </select>

            <!-- Note count -->
            <div class="note-count">
              {{ total }} notes
            </div>
          </div>

          <!-- Row 2: Search bar -->
          <div class="filter-row">
            <input type="text" name="search" class="search-input" placeholder="üîç Search notes..." value="{{ search_query or '' }}">
            <button type="submit" class="btn-search">Search</button>
          </div>

        </form>
      </div>
   
      <!-- Notes Feed -->
      <div id="notes-container">
      {% for n in notes %}
      <div class="card">
        <!-- Note content -->
        <div id="note-content-{{ n.id }}" class="note-content">
          <div class="note-title">{{ n.title }}</div>
          <div class="note-meta">
            <span class="meta-tag">üë§ {{ n.author }}</span>
            <span class="meta-tag">üìÖ {{ n.created }}</span>
            <span class="meta-tag">üìö {{ n.class }}</span>
          </div>
          <div class="note-body">{{ n.body }}</div>
        </div>

        <!-- Edit form -->
        <div id="edit-form-{{ n.id }}" class="edit-form">
          <form method="POST" action="/edit/{{ n.id }}">
            <div style="margin-bottom: 12px;">
              <input type="text" name="title" value="{{ n.title }}" placeholder="Note title" required>
            </div>
            <div style="margin-bottom: 12px;">
              <input type="text" name="author" value="{{ n.author }}" placeholder="Author name">
            </div>
            <div style="margin-bottom: 12px;">
              <select name="class">
                {% for c in classes %}
                <option value="{{ c }}" {% if c == n.class %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
              </select>
            </div>
            <div style="margin-bottom: 12px;">
              <textarea name="body" placeholder="Note content" required>{{ n.body }}</textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" class="btn-small btn-edit">üíæ Save Changes</button>
              <button type="button" class="btn-small btn-cancel" onclick="toggleEdit('{{ n.id }}')">‚ùå Cancel</button>
            </div>
          </form>
        </div>

        <!-- Action buttons -->
        <div class="note-actions">
          <button class="btn-small btn-edit" onclick="toggleEdit('{{ n.id }}')">‚úèÔ∏è Edit</button>
          <form method="POST" action="/delete/{{ n.id }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this note?');">
            <button type="submit" class="btn-small btn-delete">üóëÔ∏è Delete</button>
          </form>
        </div>
      </div>
      {% endfor %}
      </div>

      <!-- Load More button -->
      {% if has_more %}
        <div class="load-more-container">
          <button id="load-more" class="btn-small btn-edit" onclick="loadMore()">‚¨áÔ∏è Load More</button>
        </div>
      {% endif %}

      <!-- Empty state -->
      {% if notes|length == 0 %}
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <div>No notes found matching your filters.</div>
          <div style="font-size: 14px; margin-top: 8px;">Try adjusting your search or filters.</div>
        </div>
      {% endif %}
   
      <!-- Create Note Form -->
      <div class="create-section">
        <div class="section-title">‚úçÔ∏è Create New Note</div>

        <form method="POST" action="/notes-feed">
          <div class="two">
            <input type="text" name="author" placeholder="Your name (optional)">
            <input type="text" name="title" placeholder="Note title">
          </div>

          <div style="margin-top: 16px;">
            <select name="class">
              {% for c in classes %}
              <option value="{{ c }}">{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <div style="margin-top: 16px;">
            <textarea name="body" placeholder="Write your note..." required></textarea>
          </div>

          <div style="margin-top: 20px; text-align: right;">
            <button type="submit" class="btn-search">üìù Post Note</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ===== MAJOR CHANGE #5: Theme Toggle Script ===== -->
  <!-- BEFORE: No theme switching capability -->
  <!-- NOW: Loads theme-toggle.js which handles light/dark mode switching
       - Persists user preference in localStorage
       - Updates data-theme attribute on <html> element
       - All CSS variables automatically respond to theme changes
  -->
  <script src="{{ url_for('static', filename='theme-toggle.js') }}"></script>

  <!-- Pagination script (unchanged from original) -->
  <script>
    let currentPage = parseInt("{{ page|default(1) }}", 10) || 1;
    async function loadMore() {
      currentPage += 1;
      const form = document.querySelector('.filter-form');
      const params = new URLSearchParams(new FormData(form));
      params.set('page', currentPage);
      const url = '/notes?' + params.toString();
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network response was not ok');
        const data = await res.json();
        const container = document.getElementById('notes-container');
        container.insertAdjacentHTML('beforeend', data.html);
        if (!data.has_more) {
          const btn = document.getElementById('load-more');
          if (btn) btn.style.display = 'none';
        }
      } catch (err) {
        console.error('Failed to load more notes', err);
      }
    }
  </script>
</body>
</html>